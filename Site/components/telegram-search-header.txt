            {/* Telegram iOS Style Search/Filter Header */}
            <div className="sticky top-0 z-10 -mx-2 px-2 space-y-3 pb-3">
                {/* Search Bar Row */}
                <div className="relative flex items-center gap-3">
                    {/* Filter Title Capsule - fades out with scale */}
                    <div className={`relative transition-all duration-500 ease-out ${
                        isSearchExpanded ? 'absolute scale-95 pointer-events-none' : 'scale-100'
                    }`} style={{ 
                        transitionTimingFunction: 'cubic-bezier(0.34, 1.56, 0.64, 1)',
                        opacity: isSearchExpanded ? 0 : 1
                    }}>
                        <div className="absolute inset-0 bg-white/5 backdrop-blur-xl rounded-full shadow-2xl border border-white/10">
                            <div className="absolute inset-0 rounded-full bg-gradient-to-b from-white/5 via-transparent to-black/10" />
                        </div>
                        <div className="relative px-5 py-3">
                            <span className="text-white font-semibold text-base whitespace-nowrap">
                                Filter
                            </span>
                        </div>
                    </div>

                    {/* Spacer - pushes button to right when search is collapsed */}
                    <div className={`transition-all duration-500 ease-out ${
                        isSearchExpanded ? 'w-0' : 'flex-1'
                    }`} style={{ transitionTimingFunction: 'cubic-bezier(0.34, 1.56, 0.64, 1)' }} />

                    {/* Search Input Container - liquid glass expansion */}
                    <div className={`absolute transition-all duration-500 ease-out pointer-events-none ${
                        isSearchExpanded ? 'left-0 right-14 scale-100 pointer-events-auto' : 'left-auto right-0 w-12 scale-95'
                    }`} style={{ 
                        transitionTimingFunction: 'cubic-bezier(0.34, 1.56, 0.64, 1)',
                        transformOrigin: 'right center',
                        opacity: isSearchExpanded ? 1 : 0
                    }}>
                        <div className="absolute inset-0 bg-white/5 backdrop-blur-xl rounded-full shadow-2xl border border-white/10">
                            <div className="absolute inset-0 rounded-full bg-gradient-to-b from-white/5 via-transparent to-black/10" />
                        </div>
                        <div className="relative flex items-center px-5 py-3 transition-opacity duration-300"
                             style={{ 
                                transitionDelay: isSearchExpanded ? '150ms' : '0ms',
                                opacity: isSearchExpanded ? 1 : 0
                            }}>
                            <MagnifyingGlassIcon className="w-4 h-4 text-secondary mr-3 flex-shrink-0" />
                            <input
                                type="text"
                                value={searchQuery}
                                onChange={(e) => setSearchQuery(e.target.value)}
                                placeholder="Search notifications"
                                className="flex-1 bg-transparent outline-none text-foreground placeholder-secondary text-base"
                                autoFocus={isSearchExpanded}
                            />
                        </div>
                    </div>

                    {/* Search/Close button - always on right with icon transition */}
                    <button 
                        onClick={handleSearchToggle}
                        className="relative flex-shrink-0 w-12 h-12 rounded-full transition-all duration-300 active:scale-95 z-10 ml-auto"
                        style={{ transitionTimingFunction: 'cubic-bezier(0.34, 1.56, 0.64, 1)' }}
                    >
                        <div className="absolute inset-0 bg-white/5 backdrop-blur-xl rounded-full border border-white/10 shadow-xl transition-all duration-500"
                            style={{ transitionTimingFunction: 'cubic-bezier(0.34, 1.56, 0.64, 1)' }}>
                        </div>
                        <div className="absolute inset-0 rounded-full bg-gradient-to-b from-white/5 via-transparent to-black/10" />
                        <div className="relative flex items-center justify-center h-full">
                            <div className={`absolute transition-all duration-300 ${
                                isSearchExpanded ? 'opacity-0 scale-50 rotate-90' : 'opacity-100 scale-100 rotate-0'
                            }`} style={{ transitionTimingFunction: 'cubic-bezier(0.34, 1.56, 0.64, 1)' }}>
                                <MagnifyingGlassIcon className="w-5 h-5 text-secondary" strokeWidth={2.5} />
                            </div>
                            <div className={`absolute transition-all duration-300 ${
                                isSearchExpanded ? 'opacity-100 scale-100 rotate-0' : 'opacity-0 scale-50 rotate-90'
                            }`} style={{ transitionTimingFunction: 'cubic-bezier(0.34, 1.56, 0.64, 1)' }}>
                                <XMarkIcon className="w-5 h-5 text-secondary" strokeWidth={2.5} />
                            </div>
                        </div>
                    </button>
                </div>

                {/* Telegram iOS Filter Picker */}
                <div className="relative w-full">
                    {/* Fixed background pill */}
                    <div className="absolute inset-0 bg-white/5 backdrop-blur-xl rounded-full shadow-2xl border border-white/10 pointer-events-none">
                        <div className="absolute inset-0 rounded-full shadow-inner opacity-30" />
                    </div>
                    
                    {/* Scrollable content */}
                    <div ref={pickerRef} className="relative overflow-hidden rounded-full">
                        <div className="p-1 overflow-x-auto scrollbar-hide">
                            <div ref={containerRef} className={`relative flex items-center ${!shouldStretch ? 'w-max' : ''}`}>
                                {/* Animated sliding capsule */}
                                <div 
                                    className="absolute bg-white/10 border border-white/10 rounded-full shadow-[0_8px_18px_rgba(0,0,0,0.35)] pointer-events-none"
                                    style={{
                                        left: `${indicatorStyle.left}px`,
                                        width: `${indicatorStyle.width}px`,
                                        height: 'calc(100% - 2px)',
                                        top: '1px',
                                        transition: 'left 0.22s cubic-bezier(0.2, 0.8, 0.2, 1), width 0.22s cubic-bezier(0.2, 0.8, 0.2, 1)',
                                    }}
                                >
                                    <div className="absolute inset-0 rounded-full bg-gradient-to-b from-white/5 to-transparent" />
                                </div>

                                {/* Filter buttons */}
                                {[
                                    { id: 'all', label: 'All' },
                                    { id: 'unread', label: 'Unread' },
                                    { id: 'mentions', label: 'Mentions' },
                                    { id: 'comments', label: 'Comments' },
                                    { id: 'likes', label: 'Likes' }
                                ].map((tab) => {
                                    const isActive = filter === tab.id;
                                    return (
                                        <button
                                            key={tab.id}
                                            ref={(el) => { buttonRefs.current[tab.id] = el; }}
                                            onClick={() => setFilter(tab.id as any)}
                                            role="tab"
                                            aria-selected={isActive}
                                            aria-controls="notifications-panel"
                                            className={`relative ${shouldStretch ? 'flex-1' : 'flex-shrink-0 px-5'} py-2 rounded-full font-semibold text-[16px] group z-10`}
                                        >
                                            {!isActive && (
                                                <div className="absolute inset-0 bg-white/0 group-hover:bg-white/5 rounded-full transition-all duration-200" />
                                            )}
                                            
                                            <span className={`relative flex items-center justify-center whitespace-nowrap transition-all duration-400`}
                                                    style={{ 
                                                        color: isActive ? '#ffffff' : 'rgb(var(--color-secondary))',
                                                        transitionTimingFunction: 'cubic-bezier(0.34, 1.56, 0.64, 1)'
                                                    }}>
                                                {tab.label}
                                            </span>
                                        </button>
                                    );
                                })}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
